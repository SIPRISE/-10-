<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Activity System — LoliLand</title>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

<style>
/* ТВОЙ ОРИГИНАЛЬНЫЙ СТИЛЬ СОХРАНЁН */
:root{
--bg:#060812; --bg2:#0a1026; --card:#0b122b;
--border:#1b2a55; --text:#e6ecff; --accent:#7c3aed;
--success:#10b981; --warn:#facc15; --danger:#ef4444;
}
body{margin:0;padding:22px;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text);font-family:Arial}
.card{background:var(--card);border-radius:18px;padding:20px}
input,select{background:#111;color:#fff;border:1px solid #333;border-radius:8px;padding:8px}
button{border:none;border-radius:8px;padding:8px 14px;font-weight:bold;cursor:pointer}
.btn-primary{background:var(--accent);color:#fff}
.btn-success{background:var(--success)}
.btn-danger{background:var(--danger)}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #222;padding:10px;text-align:center}
.sticky-col{text-align:left;font-weight:bold}
.cell-input{width:70px;background:#1a1f3a;border:1px solid #333;color:#fff;text-align:center;cursor:pointer}
#editorModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);align-items:center;justify-content:center;z-index:1000}
.modal-box{background:#0b122b;padding:25px;border-radius:15px;display:flex;flex-direction:column;gap:10px;width:300px}
#loginScreen{position:fixed;inset:0;background:#060812;display:flex;align-items:center;justify-content:center;z-index:2000}
.login-box{background:#0b122b;padding:30px;border-radius:15px;display:flex;flex-direction:column;gap:10px;width:300px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
<div class="login-box">
<h3 style="margin:0">Введите ник</h3>
<input id="loginNick" placeholder="Nickname">
<button class="btn-primary" onclick="login()">Войти</button>
</div>
</div>

<div class="card">
<h2>Учет активности состава — LoliLand</h2>

<input type="date" id="weekStart">
<button class="btn-success admin-btn" onclick="saveWeek()">Сохранить</button>
<button class="btn-danger admin-btn" onclick="clearWeek()">Очистить</button>

<table>
<thead>
<tr><th class="sticky-col">Дата</th><th>Сумма</th></tr>
</thead>
<tbody id="bodyRows"></tbody>
</table>
</div>

<!-- МОДАЛКА -->
<div id="editorModal">
<div class="modal-box">
<h3 style="margin:0">Редактирование дня</h3>
<input id="editOnline" type="number" placeholder="Онлайн">
<input id="editMutes" type="number" placeholder="Муты">
<input id="editBans" type="number" placeholder="Баны">
<input id="editTickets" type="number" placeholder="Тикеты">
<button class="btn-success" onclick="saveDayEdit()">Сохранить</button>
<button class="btn-danger" onclick="closeModal()">Отмена</button>
</div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDugMq5xcJoVdLC9zPcAgDKCiAWpyYeyQg",
databaseURL:"https://aktiv-d4d72-default-rtdb.firebaseio.com",
projectId:"aktiv-d4d72"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

const ADMINS=["SIPRISE","playbodya_","Nesquik_"];
let currentUser=null;
let currentWeekKey="";
let weekData={days:[],entries:{}};
let editingDay=null;

/* LOGIN */
function login(){
const nick=document.getElementById("loginNick").value.trim();
if(!nick)return;
currentUser=nick;
loginScreen.style.display="none";
if(!isAdmin()){
document.querySelectorAll(".admin-btn").forEach(b=>b.style.display="none");
}
init();
}
function isAdmin(){return ADMINS.includes(currentUser);}

/* INIT */
function init(){
const today=new Date();
const monday=new Date(today);
const day=(today.getDay()+6)%7;
monday.setDate(today.getDate()-day);
const iso=monday.toISOString().slice(0,10);
weekStart.value=iso;
currentWeekKey=iso;
buildWeek(iso);
}

/* BUILD WEEK */
function buildWeek(key){
weekData.days=[];
const base=new Date(key+"T00:00:00");
base.setDate(base.getDate()-((base.getDay()+6)%7)); // понедельник
for(let i=0;i<7;i++){
const d=new Date(base);
d.setDate(base.getDate()+i);
weekData.days.push(d.toISOString().slice(0,10));
}
renderWeek();
}

/* RENDER */
function renderWeek(){
bodyRows.innerHTML="";
weekData.days.forEach((day,i)=>{
const d=new Date(day);
const fmt=d.toLocaleDateString("ru-RU",{weekday:"short",day:"2-digit"});
const e=weekData.entries[i]||{online:0,mutes:0,bans:0,tickets:0};
const sum=(+e.online||0)+(+e.mutes||0)+(+e.bans||0)+(+e.tickets||0);

const row=document.createElement("tr");
row.innerHTML=`
<td class="sticky-col">${fmt}<br><span style="font-size:10px;opacity:.6">СКРИНЫ</span></td>
<td><input class="cell-input" value="${sum}" readonly onclick="openDayEditor(${i})"></td>
`;
bodyRows.appendChild(row);
});
}

/* EDIT */
function openDayEditor(day){
if(!isAdmin())return;
editingDay=day;
const e=weekData.entries[day]||{online:0,mutes:0,bans:0,tickets:0};
editOnline.value=e.online;
editMutes.value=e.mutes;
editBans.value=e.bans;
editTickets.value=e.tickets;
editorModal.style.display="flex";
}
function closeModal(){editorModal.style.display="none";}
function saveDayEdit(){
weekData.entries[editingDay]={
online:+editOnline.value||0,
mutes:+editMutes.value||0,
bans:+editBans.value||0,
tickets:+editTickets.value||0
};
closeModal();
renderWeek();
saveWeek();
}

/* SAVE */
function saveWeek(){
if(!isAdmin())return;
db.ref("activity/"+currentWeekKey).set(weekData);
}
function clearWeek(){
if(!isAdmin())return;
if(confirm("Очистить неделю?")){
db.ref("activity/"+currentWeekKey).remove();
buildWeek(currentWeekKey);
}
}
</script>
</body>
</html>
